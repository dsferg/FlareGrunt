function Zlib(mode){if(mode<exports.DEFLATE||mode>exports.UNZIP)throw new TypeError("Bad argument");this.mode=mode,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function bufferSet(data,offset){for(var i=0;i<data.length;i++)this[offset+i]=data[i]}var msg=require("pako/lib/zlib/messages"),zstream=require("pako/lib/zlib/zstream"),zlib_deflate=require("pako/lib/zlib/deflate.js"),zlib_inflate=require("pako/lib/zlib/inflate.js"),constants=require("pako/lib/zlib/constants");for(var key in constants)exports[key]=constants[key];exports.NONE=0,exports.DEFLATE=1,exports.INFLATE=2,exports.GZIP=3,exports.GUNZIP=4,exports.DEFLATERAW=5,exports.INFLATERAW=6,exports.UNZIP=7,Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){switch(this.windowBits=windowBits,this.level=level,this.memLevel=memLevel,this.strategy=strategy,this.mode!==exports.GZIP&&this.mode!==exports.GUNZIP||(this.windowBits+=16),this.mode===exports.UNZIP&&(this.windowBits+=32),this.mode!==exports.DEFLATERAW&&this.mode!==exports.INFLATERAW||(this.windowBits=-this.windowBits),this.strm=new zstream,this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var status=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:var status=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(status!==exports.Z_OK)return void this._error(status);this.write_in_progress=!1,this.init_done=!0},Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")},Zlib.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===exports.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){this._writeCheck(),this.write_in_progress=!0;var self=this;return process.nextTick(function(){self.write_in_progress=!1;var res=self._write(flush,input,in_off,in_len,out,out_off,out_len);self.callback(res[0],res[1]),self.pending_close&&self.close()}),this},Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){return this._writeCheck(),this._write(flush,input,in_off,in_len,out,out_off,out_len)},Zlib.prototype._write=function(flush,input,in_off,in_len,out,out_off,out_len){if(this.write_in_progress=!0,flush!==exports.Z_NO_FLUSH&&flush!==exports.Z_PARTIAL_FLUSH&&flush!==exports.Z_SYNC_FLUSH&&flush!==exports.Z_FULL_FLUSH&&flush!==exports.Z_FINISH&&flush!==exports.Z_BLOCK)throw new Error("Invalid flush value");null==input&&(input=new Buffer(0),in_len=0,in_off=0),out._set?out.set=out._set:out.set=bufferSet;var strm=this.strm;switch(strm.avail_in=in_len,strm.input=input,strm.next_in=in_off,strm.avail_out=out_len,strm.output=out,strm.next_out=out_off,this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var status=zlib_deflate.deflate(strm,flush);break;case exports.UNZIP:case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:var status=zlib_inflate.inflate(strm,flush);break;default:throw new Error("Unknown mode "+this.mode)}return status!==exports.Z_STREAM_END&&status!==exports.Z_OK&&this._error(status),this.write_in_progress=!1,[strm.avail_in,strm.avail_out]},Zlib.prototype.close=function(){if(this.write_in_progress)return void(this.pending_close=!0);this.pending_close=!1,this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW?zlib_deflate.deflateEnd(this.strm):zlib_inflate.inflateEnd(this.strm),this.mode=exports.NONE},Zlib.prototype.reset=function(){switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:var status=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:var status=zlib_inflate.inflateReset(this.strm)}status!==exports.Z_OK&&this._error(status)},Zlib.prototype._error=function(status){this.onerror(msg[status]+": "+this.strm.msg,status),this.write_in_progress=!1,this.pending_close&&this.close()},exports.Zlib=Zlib;