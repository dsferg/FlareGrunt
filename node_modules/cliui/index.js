function UI(opts){this.width=opts.width,this.wrap=opts.wrap,this.rows=[]}function _minWidth(col){var padding=col.padding||[];return 1+(padding[left]||0)+(padding[right]||0)}var wrap=require("wordwrap"),align={right:require("right-align"),center:require("center-align")},top=0,right=1,bottom=2,left=3;UI.prototype.span=function(){this.div.apply(this,arguments).span=!0},UI.prototype.div=function(){if(0===arguments.length&&this.div(""),this.wrap&&this._shouldApplyLayoutDSL.apply(this,arguments))return this._applyLayoutDSL(arguments[0]);for(var arg,cols=[],i=0;void 0!==(arg=arguments[i]);i++)"string"==typeof arg?cols.push(this._colFromString(arg)):cols.push(arg);return this.rows.push(cols),cols},UI.prototype._shouldApplyLayoutDSL=function(){return 1===arguments.length&&"string"==typeof arguments[0]&&/[\t\n]/.test(arguments[0])},UI.prototype._applyLayoutDSL=function(str){var _this=this,rows=str.split("\n"),leftColumnWidth=0;return rows.forEach(function(row){var columns=row.split("\t");columns.length>1&&columns[0].length>leftColumnWidth&&(leftColumnWidth=Math.min(Math.floor(.5*_this.width),columns[0].length))}),rows.forEach(function(row){var columns=row.split("\t");_this.div.apply(_this,columns.map(function(r,i){return{text:r.trim(),padding:[0,r.match(/\s*$/)[0].length,0,r.match(/^\s*/)[0].length],width:0===i&&columns.length>1?leftColumnWidth:void 0}}))}),this.rows[this.rows.length-1]},UI.prototype._colFromString=function(str){return{text:str}},UI.prototype.toString=function(){var _this=this,lines=[];return _this.rows.forEach(function(row,i){_this.rowToString(row,lines)}),lines=lines.filter(function(line){return!line.hidden}),lines.map(function(line){return line.text}).join("\n")},UI.prototype.rowToString=function(row,lines){var paddingLeft,ts,width,wrapWidth,_this=this,rrows=this._rasterize(row),str="";return rrows.forEach(function(rrow,r){str="",rrow.forEach(function(col,c){ts="",width=row[c].width,wrapWidth=_this._negatePadding(row[c]);for(var i=0;i<Math.max(wrapWidth,col.length);i++)ts+=col.charAt(i)||" ";row[c].align&&"left"!==row[c].align&&_this.wrap&&(ts=align[row[c].align](ts.trim()+"\n"+new Array(wrapWidth+1).join(" ")).split("\n")[0],ts.length<wrapWidth&&(ts+=new Array(width-ts.length).join(" "))),paddingLeft=(row[c].padding||[0,0,0,0])[left],paddingLeft&&(str+=new Array(row[c].padding[left]+1).join(" ")),str+=ts,row[c].padding&&row[c].padding[right]&&(str+=new Array(row[c].padding[right]+1).join(" ")),0===r&&lines.length>0&&(str=_this._renderInline(str,lines[lines.length-1],paddingLeft))}),lines.push({text:str.replace(/ +$/,""),span:row.span})}),lines},UI.prototype._renderInline=function(source,previousLine,paddingLeft){var target=previousLine.text,str="";if(!previousLine.span)return source;if(!this.wrap)return previousLine.hidden=!0,target+source;for(var tc,sc,i=0;i<Math.max(source.length,target.length);i++){if(tc=target.charAt(i)||" ",sc=source.charAt(i)||" "," "!==tc&&" "!==sc)return source;if(" "!==sc&&i<paddingLeft+target.length)return source;str+=" "===tc?sc:tc}return previousLine.hidden=!0,str},UI.prototype._rasterize=function(row){var i,rrow,wrapped,_this=this,rrows=[],widths=this._columnWidths(row);return row.forEach(function(col,c){if(col.width=widths[c],wrapped=_this.wrap?wrap.hard(_this._negatePadding(col))(col.text).split("\n"):col.text.split("\n"),col.padding){for(i=0;i<(col.padding[top]||0);i++)wrapped.unshift("");for(i=0;i<(col.padding[bottom]||0);i++)wrapped.push("")}wrapped.forEach(function(str,r){rrows[r]||rrows.push([]),rrow=rrows[r];for(var i=0;i<c;i++)void 0===rrow[i]&&rrow.push("");rrow.push(str)})}),rrows},UI.prototype._negatePadding=function(col){var wrapWidth=col.width;return col.padding&&(wrapWidth-=(col.padding[left]||0)+(col.padding[right]||0)),wrapWidth},UI.prototype._columnWidths=function(row){var unsetWidth,_this=this,widths=[],unset=row.length,remainingWidth=this.width;return row.forEach(function(col,i){col.width?(unset--,widths[i]=col.width,remainingWidth-=col.width):widths[i]=void 0}),unset&&(unsetWidth=Math.floor(remainingWidth/unset)),widths.forEach(function(w,i){_this.wrap?void 0===w&&(widths[i]=Math.max(unsetWidth,_minWidth(row[i]))):widths[i]=row[i].width||row[i].text.length}),widths},module.exports=function(opts){return opts=opts||{},new UI({width:(opts||{}).width||80,wrap:"boolean"!=typeof opts.wrap||opts.wrap})};